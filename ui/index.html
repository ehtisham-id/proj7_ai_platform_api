<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Platform API - Neural Interface</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CDN Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.5/dist/axios.min.js"></script>
    <script src="https://unpkg.com/filepond@4.30.4/dist/filepond.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link href="https://unpkg.com/filepond@4.30.4/dist/filepond.min.css" rel="stylesheet">
    
    <style>
        :root {
            --neon-blue: #00f0ff;
            --neon-purple: #b000ff;
            --neon-pink: #ff00aa;
            --dark-bg: #0a0e1a;
            --dark-surface: #141824;
            --glass-bg: rgba(20, 24, 36, 0.7);
            --glass-border: rgba(0, 240, 255, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated Background */
        .bg-animated {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(176, 0, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 0, 170, 0.05) 0%, transparent 50%);
            animation: bgPulse 15s ease-in-out infinite;
        }
        
        @keyframes bgPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: 1;
            pointer-events: none;
        }
        
        /* Glass Morphism */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 
                0 8px 32px 0 rgba(0, 240, 255, 0.1),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
        }
        
        .glass:hover {
            border-color: var(--neon-blue);
            box-shadow: 
                0 8px 32px 0 rgba(0, 240, 255, 0.3),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Neon Text */
        .neon-text {
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--neon-blue);
            text-shadow: 
                0 0 10px var(--neon-blue),
                0 0 20px var(--neon-blue),
                0 0 30px var(--neon-blue);
            animation: neonFlicker 3s ease-in-out infinite;
        }
        
        @keyframes neonFlicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            75% { opacity: 0.9; }
        }
        
        .title-glow {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.5));
            animation: titlePulse 2s ease-in-out infinite;
        }
        
        @keyframes titlePulse {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 240, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(0, 240, 255, 0.8)); }
        }
        
        /* Buttons */
        .btn-neon {
            position: relative;
            padding: 12px 32px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: transparent;
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-neon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-neon:hover::before {
            left: 100%;
        }
        
        .btn-neon:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 
                0 0 20px var(--neon-blue),
                0 0 40px var(--neon-blue),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
        }
        
        .btn-purple {
            border-color: var(--neon-purple);
            color: var(--neon-purple);
        }
        
        .btn-purple:hover {
            background: var(--neon-purple);
            box-shadow: 
                0 0 20px var(--neon-purple),
                0 0 40px var(--neon-purple);
        }
        
        .btn-pink {
            border-color: var(--neon-pink);
            color: var(--neon-pink);
        }
        
        .btn-pink:hover {
            background: var(--neon-pink);
            box-shadow: 
                0 0 20px var(--neon-pink),
                0 0 40px var(--neon-pink);
        }
        
        /* Input Fields */
        .input-cyber {
            background: rgba(20, 24, 36, 0.5);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: #fff;
            padding: 12px 16px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .input-cyber:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 
                0 0 20px rgba(0, 240, 255, 0.3),
                inset 0 0 10px rgba(0, 240, 255, 0.1);
        }
        
        .input-cyber::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }
        
        /* Sidebar Menu */
        .sidebar {
            position: relative;
            z-index: 10;
            height: 100vh;
            overflow-y: auto;
        }
        
        .menu-item {
            position: relative;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding: 16px 24px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(0, 240, 255, 0.1);
            border-left-color: var(--neon-blue);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: rgba(0, 240, 255, 0.2);
            border-left-color: var(--neon-blue);
            box-shadow: inset 0 0 20px rgba(0, 240, 255, 0.2);
        }
        
        .menu-icon {
            font-size: 24px;
            margin-right: 12px;
            filter: drop-shadow(0 0 5px currentColor);
        }
        
        /* Content Area */
        .content-wrapper {
            position: relative;
            z-index: 10;
            padding: 40px;
            height: 100vh;
            overflow-y: auto;
        }
        
        .section-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }
        
        .section-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Card Animations */
        .card {
            animation: slideIn 0.6s ease-out;
            animation-fill-mode: both;
        }
        
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 9999;
            padding: 20px 30px;
            border-radius: 8px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 16px;
            animation: toastSlide 0.5s ease-out;
        }
        
        @keyframes toastSlide {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast-success {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.9), rgba(0, 200, 255, 0.9));
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.5);
        }
        
        .toast-error {
            background: linear-gradient(135deg, rgba(255, 0, 170, 0.9), rgba(200, 0, 150, 0.9));
            border: 1px solid var(--neon-pink);
            box-shadow: 0 0 30px rgba(255, 0, 170, 0.5);
        }
        
        /* Section Headers */
        .section-header {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            display: inline-block;
        }
        
        .section-header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-blue), transparent);
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        /* Subsection Headers */
        .subsection-header {
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1.3rem;
            color: var(--neon-blue);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        /* Results Display */
        .result-display {
            background: rgba(0, 20, 40, 0.5);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: var(--neon-blue);
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        /* Debug Console */
        .debug-console {
            background: rgba(10, 14, 26, 0.95);
            border: 1px solid rgba(176, 0, 255, 0.4);
            border-radius: 8px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-entry {
            background: rgba(20, 24, 36, 0.8);
            border-left: 3px solid var(--neon-purple);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            animation: debugFadeIn 0.3s ease-out;
        }
        
        @keyframes debugFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .debug-title {
            color: var(--neon-purple);
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .debug-content {
            color: #00ff88;
        }
        
        /* Token Display */
        .token-display {
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--neon-blue);
            word-break: break-all;
            margin-bottom: 15px;
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(10, 14, 26, 0.5);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--neon-blue), var(--neon-purple));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-blue);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 240, 255, 0.3);
            border-top-color: var(--neon-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Hover Effects */
        .hover-glow {
            transition: all 0.3s ease;
        }
        
        .hover-glow:hover {
            filter: drop-shadow(0 0 15px currentColor);
        }
        
        /* Grid Layout */
        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }
        
        /* File Upload Styling */
        .filepond--root {
            font-family: 'Rajdhani', sans-serif;
        }
        
        .filepond--panel-root {
            background: rgba(20, 24, 36, 0.5);
            border: 2px dashed rgba(0, 240, 255, 0.4);
        }
        
        .filepond--drop-label {
            color: var(--neon-blue);
        }
        
        /* Select Dropdown */
        .select-cyber {
            background: rgba(20, 24, 36, 0.5);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: #fff;
            padding: 12px 16px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .select-cyber:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }
        
        .select-cyber option {
            background: var(--dark-surface);
            color: #fff;
        }
        
        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .status-connected {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }
        
        .status-disconnected {
            background: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Link Styling */
        a {
            color: var(--neon-blue);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }
        
        a:hover {
            color: var(--neon-purple);
            text-shadow: 0 0 10px currentColor;
        }
        
        a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--neon-blue);
            transition: width 0.3s ease;
        }
        
        a:hover::after {
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="bg-animated"></div>
    <div class="grid-overlay"></div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const API_BASE = "http://localhost:8000/api/v1";
        const WS_BASE = "ws://localhost:8000/ws/notifications";
        const USE_WS_AUTH_QUERY = true;

        // ============================================
        // HELPER FUNCTIONS
        // ============================================
        let accessToken = localStorage.getItem('access_token') || '';
        let refreshToken = localStorage.getItem('refresh_token') || '';

        function authHeaders() {
            return accessToken ? { 'Authorization': `Bearer ${accessToken}` } : {};
        }

        function saveTokens(access, refresh) {
            accessToken = access;
            refreshToken = refresh;
            localStorage.setItem('access_token', access);
            if (refresh) localStorage.setItem('refresh_token', refresh);
            updateTokenDisplay();
        }

        function clearTokens() {
            accessToken = '';
            refreshToken = '';
            localStorage.removeItem('access_token');
            localStorage.removeItem('refresh_token');
            updateTokenDisplay();
        }

        function updateTokenDisplay() {
            document.getElementById('token-display').textContent = 
                accessToken ? `TOKEN: ${accessToken.substring(0, 30)}...` : 'NO TOKEN SET';
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'toastSlide 0.3s ease-in reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function logDebug(title, data) {
            const console = document.getElementById('debug-console');
            const entry = document.createElement('div');
            entry.className = 'debug-entry';
            entry.innerHTML = `
                <div class="debug-title">${title}</div>
                <pre class="debug-content">${JSON.stringify(data, null, 2)}</pre>
            `;
            console.insertBefore(entry, console.firstChild);
        }

        async function handleResponse(promise, successMsg) {
            try {
                const response = await promise;
                logDebug('Response', response.data);
                showToast(successMsg);
                return response.data;
            } catch (error) {
                handleError(error);
                throw error;
            }
        }

        function handleError(error) {
            const msg = error.response?.data?.detail || error.message || 'Request failed';
            logDebug('Error', { message: msg, status: error.response?.status });
            showToast(msg, 'error');
        }

        function multipartJSONField(formData, name, obj) {
            formData.append(name, JSON.stringify(obj));
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            showToast('Copied to clipboard');
        }

        function switchSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
        }

        // ============================================
        // API FUNCTIONS (COMPACT VERSION - SAME AS BEFORE)
        // ============================================

        async function register() {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const data = await handleResponse(
                axios.post(`${API_BASE}/auth/register`, { email, password, role: 'user' }),
                'Registration successful'
            );
            document.getElementById('auth-result').textContent = JSON.stringify(data, null, 2);
        }

        async function login() {
            const username = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const formData = new URLSearchParams();
            formData.append('username', username);
            formData.append('password', password);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/auth/login`, formData, {
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                }),
                'Login successful'
            );
            saveTokens(data.access_token, data.refresh_token);
            document.getElementById('auth-result').textContent = JSON.stringify(data, null, 2);
        }

        async function refresh() {
            const data = await handleResponse(
                axios.post(`${API_BASE}/auth/refresh`, { refresh_token: refreshToken }),
                'Token refreshed'
            );
            saveTokens(data.access_token, data.refresh_token);
            document.getElementById('auth-result').textContent = JSON.stringify(data, null, 2);
        }

        async function uploadFile() {
            const fileInput = document.getElementById('file-upload');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/files/`, formData, { headers: authHeaders() }),
                'File uploaded'
            );
            displayFileResult(data);
        }

        async function getFile() {
            const fileId = document.getElementById('file-id-get').value;
            const response = await axios.get(`${API_BASE}/files/${fileId}`, {
                headers: authHeaders(),
                responseType: 'blob'
            });
            
            const url = window.URL.createObjectURL(new Blob([response.data]));
            const link = document.createElement('a');
            link.href = url;
            link.setAttribute('download', `file_${fileId}`);
            document.body.appendChild(link);
            link.click();
            link.remove();
            showToast('File downloaded');
        }

        async function deleteFile() {
            const fileId = document.getElementById('file-id-delete').value;
            await handleResponse(
                axios.delete(`${API_BASE}/files/${fileId}`, { headers: authHeaders() }),
                'File deleted'
            );
        }

        async function renameFile() {
            const fileId = document.getElementById('file-id-rename').value;
            const newName = document.getElementById('file-new-name').value;
            const data = await handleResponse(
                axios.put(`${API_BASE}/files/${fileId}/rename`, { new_name: newName }, { headers: authHeaders() }),
                'File renamed'
            );
            displayFileResult(data);
        }

        async function getVersions() {
            const fileId = document.getElementById('file-id-versions').value;
            const data = await handleResponse(
                axios.get(`${API_BASE}/files/${fileId}/versions`, { headers: authHeaders() }),
                'Versions retrieved'
            );
            document.getElementById('files-result').textContent = JSON.stringify(data, null, 2);
        }

        function displayFileResult(data) {
            const result = document.getElementById('files-result');
            result.innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-2"><span class="text-neon-blue">FILE ID:</span> ${data.id}</p>
                    <p class="mb-2"><span class="text-neon-blue">FILENAME:</span> ${data.filename}</p>
                    <p class="mb-2"><span class="text-neon-blue">SIZE:</span> ${data.size_bytes} bytes</p>
                    <p class="mb-4"><span class="text-neon-blue">MIME:</span> ${data.mime_type || 'N/A'}</p>
                    ${data.url ? `<a href="${data.url}" target="_blank" class="hover-glow">‚Üì DOWNLOAD FILE</a>` : ''}
                </div>
            `;
        }

        async function convertFile() {
            const fileInput = document.getElementById('convert-file');
            const targetFormat = document.getElementById('convert-format').value;
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            multipartJSONField(formData, 'conversion', { target_format: targetFormat });
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/convert/`, formData, { headers: authHeaders() }),
                'File converted'
            );
            displayConvertResult(data);
        }

        function displayConvertResult(data) {
            document.getElementById('convert-result').innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-2"><span class="text-neon-purple">FILE ID:</span> ${data.converted_file_id}</p>
                    <p class="mb-2"><span class="text-neon-purple">FILENAME:</span> ${data.filename}</p>
                    <p class="mb-2"><span class="text-neon-purple">FORMAT:</span> ${data.source_format} ‚Üí ${data.target_format}</p>
                    <p class="mb-4"><span class="text-neon-purple">SIZE:</span> ${data.size_bytes} bytes</p>
                    <a href="${data.url}" target="_blank" class="hover-glow">‚Üì DOWNLOAD CONVERTED</a>
                </div>
            `;
        }

        async function editPhoto() {
            const fileInput = document.getElementById('photo-file');
            const filter = document.getElementById('photo-filter').value;
            const rotate = parseInt(document.getElementById('photo-rotate').value);
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const operations = { filter, rotate };
            const cropX = document.getElementById('crop-x').value;
            if (cropX) {
                operations.crop = {
                    x: parseInt(cropX),
                    y: parseInt(document.getElementById('crop-y').value),
                    w: parseInt(document.getElementById('crop-w').value),
                    h: parseInt(document.getElementById('crop-h').value)
                };
            }
            
            multipartJSONField(formData, 'operations', operations);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/photo/edit`, formData, { headers: authHeaders() }),
                'Photo edited'
            );
            displayPhotoResult(data);
        }

        function displayPhotoResult(data) {
            document.getElementById('photo-result').innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-2"><span class="text-neon-pink">FILE ID:</span> ${data.edited_file_id}</p>
                    <p class="mb-2"><span class="text-neon-pink">FILENAME:</span> ${data.filename}</p>
                    <p class="mb-4"><span class="text-neon-pink">SIZE:</span> ${data.size_bytes} bytes</p>
                    <a href="${data.url}" target="_blank" class="hover-glow mb-4 block">‚Üì DOWNLOAD EDITED</a>
                    <img src="${data.url}" class="w-full max-w-2xl rounded-lg border-2 border-neon-pink" style="border-color: var(--neon-pink)" alt="Edited">
                </div>
            `;
        }

        async function mergePDF() {
            const fileInput = document.getElementById('pdf-merge-files');
            const formData = new FormData();
            Array.from(fileInput.files).forEach(file => {
                formData.append('files', file);
            });
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/pdf/merge`, formData, { headers: authHeaders() }),
                'PDFs merged'
            );
            document.getElementById('pdf-result').textContent = JSON.stringify(data, null, 2);
        }

        async function convertToPDF() {
            const fileInput = document.getElementById('pdf-convert-file');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/pdf/convert`, formData, { headers: authHeaders() }),
                'Converted to PDF'
            );
            document.getElementById('pdf-result').textContent = JSON.stringify(data, null, 2);
        }

        async function generateQR() {
            const text = document.getElementById('qr-text').value;
            const size = parseInt(document.getElementById('qr-size').value);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/qrcode/generate`, { text, size }, { headers: authHeaders() }),
                'QR code generated'
            );
            
            document.getElementById('qr-result').innerHTML = `
                <div class="glass p-6 rounded-lg text-center">
                    <p class="mb-2"><span class="text-neon-blue">QR ID:</span> ${data.qrcode_file_id}</p>
                    <p class="mb-4"><span class="text-neon-blue">SIZE:</span> ${data.size}px</p>
                    <img src="${data.url}" class="mx-auto mb-4 border-2 rounded-lg" style="border-color: var(--neon-blue)" alt="QR">
                    <a href="${data.url}" target="_blank" class="hover-glow">‚Üì DOWNLOAD QR</a>
                </div>
            `;
        }

        let pollInterval;
        async function summarizeFile() {
            const fileInput = document.getElementById('summarize-file');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/summarize/`, formData, { headers: authHeaders() }),
                'Summarization queued'
            );
            
            document.getElementById('summarize-result').innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-2"><span class="text-neon-purple">JOB ID:</span> ${data.job_id}</p>
                    <p class="mb-4"><span class="text-neon-purple">STATUS:</span> ${data.status}</p>
                    <div class="loading"></div> <span class="ml-2">Polling for results...</span>
                </div>
            `;
            
            pollInterval = setInterval(async () => {
                try {
                    const jobData = await axios.get(`${API_BASE}/summarize/jobs/${data.job_id}`, { headers: authHeaders() });
                    logDebug('Job Status', jobData.data);
                    
                    if (jobData.data.status === 'completed') {
                        clearInterval(pollInterval);
                        document.getElementById('summarize-result').innerHTML = `
                            <div class="glass p-6 rounded-lg">
                                <p class="mb-4"><span class="text-neon-purple">STATUS:</span> ‚úì COMPLETED</p>
                                <a href="${jobData.data.result_url}" target="_blank" class="hover-glow">‚Üì DOWNLOAD SUMMARY</a>
                            </div>
                        `;
                        showToast('Summarization completed');
                    }
                } catch (err) {
                    clearInterval(pollInterval);
                    handleError(err);
                }
            }, 2000);
        }

        async function createARMenu() {
            const fileInput = document.getElementById('ar-menu-file');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/ar/menu/create`, formData, { headers: authHeaders() }),
                'AR Menu created'
            );
            
            document.getElementById('ar-result').innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-2"><span class="text-neon-blue">MENU ID:</span> ${data.ar_menu_id}</p>
                    <p class="mb-2"><span class="text-neon-blue">ITEMS:</span> ${data.item_count}</p>
                    <p class="mb-4"><span class="text-neon-blue">QR CODES:</span> ${data.qr_count}</p>
                    <a href="${data.preview_url}" target="_blank" class="hover-glow block mb-2">üëÅ PREVIEW</a>
                    <a href="${data.menu_url}" target="_blank" class="hover-glow">üîó MENU URL</a>
                </div>
            `;
        }

        let analysisChart;
        async function uploadAnalysis() {
            const fileInput = document.getElementById('analysis-file');
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            
            const data = await handleResponse(
                axios.post(`${API_BASE}/analysis/upload`, formData, { headers: authHeaders() }),
                'Analysis completed'
            );
            
            document.getElementById('analysis-result').innerHTML = `
                <div class="glass p-6 rounded-lg">
                    <p class="mb-4"><span class="text-neon-purple">ANALYSIS ID:</span> ${data.analysis_id}</p>
                    <pre class="result-display mb-4">${JSON.stringify(data.summary, null, 2)}</pre>
                    <canvas id="analysis-chart"></canvas>
                </div>
            `;
            
            if (data.summary && data.summary.rows) {
                const ctx = document.getElementById('analysis-chart').getContext('2d');
                if (analysisChart) analysisChart.destroy();
                analysisChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Rows', 'Columns'],
                        datasets: [{
                            label: 'Data Metrics',
                            data: [data.summary.rows, data.columns?.length || 0],
                            backgroundColor: [
                                'rgba(0, 240, 255, 0.6)',
                                'rgba(176, 0, 255, 0.6)'
                            ],
                            borderColor: [
                                'rgba(0, 240, 255, 1)',
                                'rgba(176, 0, 255, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        animation: { duration: 1500, easing: 'easeInOutQuart' },
                        plugins: {
                            legend: {
                                labels: { color: '#fff', font: { family: 'Rajdhani' } }
                            }
                        },
                        scales: {
                            y: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(0, 240, 255, 0.1)' }
                            },
                            x: {
                                ticks: { color: '#fff' },
                                grid: { color: 'rgba(0, 240, 255, 0.1)' }
                            }
                        }
                    }
                });
            }
        }

        let ws;
        function connectWebSocket() {
            const url = USE_WS_AUTH_QUERY 
                ? `${WS_BASE}?token=${accessToken}`
                : WS_BASE;
            
            ws = new WebSocket(url);
            
            ws.onopen = () => {
                showToast('WebSocket connected');
                document.getElementById('ws-status').innerHTML = '<span class="status-indicator status-connected"></span>CONNECTED';
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                logDebug('WebSocket Message', data);
                
                const notif = document.createElement('div');
                notif.className = 'glass p-4 rounded-lg mb-3';
                notif.style.animation = 'slideIn 0.5s ease-out';
                notif.innerHTML = `
                    <div class="text-neon-blue font-bold mb-2">${data.message}</div>
                    <pre class="text-xs text-gray-400">${JSON.stringify(data.data, null, 2)}</pre>
                `;
                document.getElementById('ws-notifications').insertBefore(notif, document.getElementById('ws-notifications').firstChild);
            };
            
            ws.onerror = (error) => {
                showToast('WebSocket error', 'error');
                logDebug('WebSocket Error', error);
            };
            
            ws.onclose = () => {
                showToast('WebSocket disconnected', 'error');
                document.getElementById('ws-status').innerHTML = '<span class="status-indicator status-disconnected"></span>DISCONNECTED';
            };
        }

        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        window.onload = () => {
            updateTokenDisplay();
            switchSection('auth-section');
            
            document.getElementById('fill-register').onclick = () => {
                document.getElementById('reg-email').value = 'test@example.com';
                document.getElementById('reg-password').value = 'password123';
            };
            
            document.getElementById('fill-login').onclick = () => {
                document.getElementById('login-email').value = 'test@example.com';
                document.getElementById('login-password').value = 'password123';
            };
            
            document.getElementById('fill-qr').onclick = () => {
                document.getElementById('qr-text').value = 'https://example.com';
                document.getElementById('qr-size').value = '256';
            };
        };
    </script>

    <div style="display: flex; position: relative; z-index: 10;">
        <!-- Sidebar -->
        <div class="sidebar glass" style="width: 280px; border-right: 2px solid rgba(0, 240, 255, 0.3);">
            <div style="padding: 30px 20px;">
                <h1 class="title-glow mb-8">NEURAL API</h1>
                
                <div class="token-display" id="token-display"></div>
                <button onclick="clearTokens()" class="btn-neon btn-pink w-full mb-8" style="font-size: 12px; padding: 10px;">RESET TOKENS</button>
                
                <nav>
                    <div class="menu-item active" onclick="switchSection('auth-section')" data-section="auth-section">
                        <span class="menu-icon">üîê</span> AUTH
                    </div>
                    <div class="menu-item" onclick="switchSection('files-section')" data-section="files-section">
                        <span class="menu-icon">üìÅ</span> FILES
                    </div>
                    <div class="menu-item" onclick="switchSection('convert-section')" data-section="convert-section">
                        <span class="menu-icon">üîÑ</span> CONVERT
                    </div>
                    <div class="menu-item" onclick="switchSection('photo-section')" data-section="photo-section">
                        <span class="menu-icon">üñºÔ∏è</span> PHOTO
                    </div>
                    <div class="menu-item" onclick="switchSection('pdf-section')" data-section="pdf-section">
                        <span class="menu-icon">üìÑ</span> PDF
                    </div>
                    <div class="menu-item" onclick="switchSection('qr-section')" data-section="qr-section">
                        <span class="menu-icon">üì±</span> QR CODE
                    </div>
                    <div class="menu-item" onclick="switchSection('summarize-section')" data-section="summarize-section">
                        <span class="menu-icon">üìù</span> SUMMARIZE
                    </div>
                    <div class="menu-item" onclick="switchSection('ar-section')" data-section="ar-section">
                        <span class="menu-icon">ü•Ω</span> AR MENU
                    </div>
                    <div class="menu-item" onclick="switchSection('analysis-section')" data-section="analysis-section">
                        <span class="menu-icon">üìä</span> ANALYSIS
                    </div>
                    <div class="menu-item" onclick="switchSection('ws-section')" data-section="ws-section">
                        <span class="menu-icon">üîî</span> WEBSOCKET
                    </div>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content-wrapper" style="flex: 1;">
            <!-- Auth Section -->
            <div id="auth-section" class="section-content active">
                <h2 class="section-header">AUTHENTICATION</h2>
                
                <div class="grid-layout">
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">REGISTER</h3>
                        <input id="reg-email" type="email" placeholder="Email Address" class="input-cyber w-full rounded mb-3">
                        <input id="reg-password" type="password" placeholder="Password" class="input-cyber w-full rounded mb-4">
                        <button onclick="register()" class="btn-neon w-full rounded">REGISTER</button>
                        <button id="fill-register" class="btn-neon btn-purple w-full rounded mt-3" style="font-size: 11px; padding: 8px;">FILL EXAMPLE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">LOGIN</h3>
                        <input id="login-email" type="email" placeholder="Email Address" class="input-cyber w-full rounded mb-3">
                        <input id="login-password" type="password" placeholder="Password" class="input-cyber w-full rounded mb-4">
                        <button onclick="login()" class="btn-neon w-full rounded">LOGIN</button>
                        <button id="fill-login" class="btn-neon btn-purple w-full rounded mt-3" style="font-size: 11px; padding: 8px;">FILL EXAMPLE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">REFRESH TOKEN</h3>
                        <p class="text-gray-400 mb-4" style="font-size: 14px;">Refresh your authentication token to maintain session.</p>
                        <button onclick="refresh()" class="btn-neon btn-purple w-full rounded">REFRESH</button>
                    </div>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <pre id="auth-result" class="result-display"></pre>
                </div>
            </div>

            <!-- Files Section -->
            <div id="files-section" class="section-content">
                <h2 class="section-header">FILE MANAGEMENT</h2>
                
                <div class="grid-layout">
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">UPLOAD</h3>
                        <input id="file-upload" type="file" class="input-cyber w-full rounded mb-4">
                        <button onclick="uploadFile()" class="btn-neon w-full rounded">UPLOAD FILE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">DOWNLOAD</h3>
                        <input id="file-id-get" type="number" placeholder="File ID" class="input-cyber w-full rounded mb-4">
                        <button onclick="getFile()" class="btn-neon w-full rounded">GET FILE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">DELETE</h3>
                        <input id="file-id-delete" type="number" placeholder="File ID" class="input-cyber w-full rounded mb-4">
                        <button onclick="deleteFile()" class="btn-neon btn-pink w-full rounded">DELETE FILE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">RENAME</h3>
                        <input id="file-id-rename" type="number" placeholder="File ID" class="input-cyber w-full rounded mb-3">
                        <input id="file-new-name" type="text" placeholder="New Filename" class="input-cyber w-full rounded mb-4">
                        <button onclick="renameFile()" class="btn-neon btn-purple w-full rounded">RENAME FILE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">VERSIONS</h3>
                        <input id="file-id-versions" type="number" placeholder="File ID" class="input-cyber w-full rounded mb-4">
                        <button onclick="getVersions()" class="btn-neon w-full rounded">GET VERSIONS</button>
                    </div>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="files-result" class="result-display"></div>
                </div>
            </div>

            <!-- Convert Section -->
            <div id="convert-section" class="section-content">
                <h2 class="section-header">FILE CONVERSION</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">CONVERT FILE</h3>
                    <input id="convert-file" type="file" class="input-cyber w-full rounded mb-4">
                    <select id="convert-format" class="select-cyber w-full rounded mb-4">
                        <option value="pdf">PDF</option>
                        <option value="docx">DOCX</option>
                        <option value="txt">TXT</option>
                        <option value="jpg">JPG</option>
                        <option value="png">PNG</option>
                    </select>
                    <button onclick="convertFile()" class="btn-neon w-full rounded">CONVERT</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="convert-result"></div>
                </div>
            </div>

            <!-- Photo Section -->
            <div id="photo-section" class="section-content">
                <h2 class="section-header">PHOTO EDITING</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">EDIT PHOTO</h3>
                    <input id="photo-file" type="file" accept="image/*" class="input-cyber w-full rounded mb-4">
                    
                    <label class="block text-sm mb-2" style="color: var(--neon-pink)">FILTER:</label>
                    <select id="photo-filter" class="select-cyber w-full rounded mb-4">
                        <option value="">None</option>
                        <option value="grayscale">Grayscale</option>
                        <option value="sepia">Sepia</option>
                        <option value="blur">Blur</option>
                    </select>
                    
                    <label class="block text-sm mb-2" style="color: var(--neon-pink)">ROTATE (degrees):</label>
                    <input id="photo-rotate" type="number" value="0" class="input-cyber w-full rounded mb-4">
                    
                    <label class="block text-sm mb-2" style="color: var(--neon-pink)">CROP (optional):</label>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;" class="mb-4">
                        <input id="crop-x" type="number" placeholder="X" class="input-cyber rounded">
                        <input id="crop-y" type="number" placeholder="Y" class="input-cyber rounded">
                        <input id="crop-w" type="number" placeholder="W" class="input-cyber rounded">
                        <input id="crop-h" type="number" placeholder="H" class="input-cyber rounded">
                    </div>
                    
                    <button onclick="editPhoto()" class="btn-neon btn-pink w-full rounded">EDIT PHOTO</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="photo-result"></div>
                </div>
            </div>

            <!-- PDF Section -->
            <div id="pdf-section" class="section-content">
                <h2 class="section-header">PDF OPERATIONS</h2>
                
                <div class="grid-layout">
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">MERGE PDFs</h3>
                        <input id="pdf-merge-files" type="file" accept=".pdf" multiple class="input-cyber w-full rounded mb-4">
                        <button onclick="mergePDF()" class="btn-neon w-full rounded">MERGE</button>
                    </div>
                    
                    <div class="card glass rounded-lg p-6">
                        <h3 class="subsection-header">CONVERT TO PDF</h3>
                        <input id="pdf-convert-file" type="file" class="input-cyber w-full rounded mb-4">
                        <button onclick="convertToPDF()" class="btn-neon btn-purple w-full rounded">CONVERT</button>
                    </div>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <pre id="pdf-result" class="result-display"></pre>
                </div>
            </div>

            <!-- QR Section -->
            <div id="qr-section" class="section-content">
                <h2 class="section-header">QR CODE GENERATOR</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">GENERATE QR CODE</h3>
                    <input id="qr-text" type="text" placeholder="Text or URL" class="input-cyber w-full rounded mb-3">
                    <input id="qr-size" type="number" placeholder="Size (px)" value="256" class="input-cyber w-full rounded mb-4">
                    <button onclick="generateQR()" class="btn-neon w-full rounded mb-3">GENERATE</button>
                    <button id="fill-qr" class="btn-neon btn-purple w-full rounded" style="font-size: 11px; padding: 8px;">FILL EXAMPLE</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="qr-result"></div>
                </div>
            </div>

            <!-- Summarize Section -->
            <div id="summarize-section" class="section-content">
                <h2 class="section-header">TEXT SUMMARIZATION</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">UPLOAD TEXT FILE</h3>
                    <input id="summarize-file" type="file" accept=".txt,.md" class="input-cyber w-full rounded mb-4">
                    <button onclick="summarizeFile()" class="btn-neon btn-purple w-full rounded">SUMMARIZE</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="summarize-result"></div>
                </div>
            </div>

            <!-- AR Section -->
            <div id="ar-section" class="section-content">
                <h2 class="section-header">AR MENU CREATOR</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">UPLOAD MENU DATA</h3>
                    <p class="text-gray-400 mb-4" style="font-size: 14px;">Upload CSV or JSON file containing menu items</p>
                    <input id="ar-menu-file" type="file" accept=".csv,.json" class="input-cyber w-full rounded mb-4">
                    <button onclick="createARMenu()" class="btn-neon w-full rounded">CREATE AR MENU</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="ar-result"></div>
                </div>
            </div>

            <!-- Analysis Section -->
            <div id="analysis-section" class="section-content">
                <h2 class="section-header">DATA ANALYSIS</h2>
                
                <div class="card glass rounded-lg p-6">
                    <h3 class="subsection-header">UPLOAD DATA FILE</h3>
                    <p class="text-gray-400 mb-4" style="font-size: 14px;">Upload CSV or XLSX file for analysis</p>
                    <input id="analysis-file" type="file" accept=".csv,.xlsx" class="input-cyber w-full rounded mb-4">
                    <button onclick="uploadAnalysis()" class="btn-neon btn-purple w-full rounded">ANALYZE</button>
                </div>
                
                <div class="glass rounded-lg p-6 mt-6">
                    <h3 class="subsection-header">RESPONSE</h3>
                    <div id="analysis-result"></div>
                </div>
            </div>

            <!-- WebSocket Section -->
            <div id="ws-section" class="section-content">
                <h2 class="section-header">WEBSOCKET NOTIFICATIONS</h2>
                
                <div class="card glass rounded-lg p-6 mb-6">
                    <h3 class="subsection-header">CONNECTION</h3>
                    <p class="mb-4" id="ws-status"><span class="status-indicator status-disconnected"></span>DISCONNECTED</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <button onclick="connectWebSocket()" class="btn-neon rounded">CONNECT</button>
                        <button onclick="disconnectWebSocket()" class="btn-neon btn-pink rounded">DISCONNECT</button>
                    </div>
                </div>
                
                <div class="glass rounded-lg p-6">
                    <h3 class="subsection-header">NOTIFICATIONS</h3>
                    <div id="ws-notifications" style="max-height: 500px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- Debug Console -->
            <div class="glass rounded-lg p-6 mt-8">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 class="subsection-header" style="margin: 0;">DEBUG CONSOLE</h3>
                    <button onclick="document.getElementById('debug-console').innerHTML=''" class="btn-neon btn-pink rounded" style="font-size: 11px; padding: 8px 16px;">CLEAR</button>
                </div>
                <div id="debug-console" class="debug-console"></div>
            </div>
        </div>
    </div>
</body>
</html>